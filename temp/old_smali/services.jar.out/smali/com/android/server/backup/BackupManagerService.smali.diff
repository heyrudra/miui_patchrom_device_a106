*** ./smali/com/android/server/backup/BackupManagerService.smali	2018-02-09 22:28:22.742209552 +0530
--- /root/prithvi/patchrom/device/temp/new_smali/services.jar.out/./smali/com/android/server/backup/BackupManagerService.smali	2018-02-09 22:18:00.108707387 +0530
***************
*** 7285,7290 ****
--- 7285,7298 ----
  
      invoke-static {v5, v6}, Landroid/util/Slog;->d(Ljava/lang/String;Ljava/lang/String;)I
  
+     invoke-static {}, Landroid/os/Binder;->getCallingUid()I
+ 
+     move-result v5
+ 
+     const/16 v6, 0x3e8
+ 
+     if-eq v5, v6, :cond_miui_0
+ 
      iget-object v5, p0, Lcom/android/server/backup/BackupManagerService;->mContext:Landroid/content/Context;
  
      const-string v6, "android.permission.BACKUP"
***************
*** 7293,7298 ****
--- 7301,7307 ----
  
      invoke-virtual {v5, v6, v7}, Landroid/content/Context;->enforceCallingPermission(Ljava/lang/String;Ljava/lang/String;)V
  
+     :cond_miui_0
      invoke-static {}, Landroid/os/Binder;->clearCallingIdentity()J
  
      move-result-wide v2
***************
*** 10083,10093 ****
  
      const-string v3, "fullback"
  
      move-object/from16 v0, p0
  
      move/from16 v1, v16
  
!     invoke-virtual {v0, v1, v3}, Lcom/android/server/backup/BackupManagerService;->startConfirmationUi(ILjava/lang/String;)Z
  
      move-result v3
  
--- 10092,10106 ----
  
      const-string v3, "fullback"
  
+     invoke-virtual/range {p1 .. p1}, Landroid/os/ParcelFileDescriptor;->getFd()I
+ 
+     move-result v4
+ 
      move-object/from16 v0, p0
  
      move/from16 v1, v16
  
!     invoke-static {v0, v1, v3, v4}, Lcom/android/server/backup/BackupManagerServiceInjector;->startConfirmationUi(Lcom/android/server/backup/BackupManagerService;ILjava/lang/String;I)Z
  
      move-result v3
  
***************
*** 10177,10188 ****
  
      invoke-virtual {v3, v4, v5, v6, v7}, Landroid/os/PowerManager;->userActivity(JII)V
  
-     move-object/from16 v0, p0
- 
-     move/from16 v1, v16
- 
-     invoke-virtual {v0, v1, v2}, Lcom/android/server/backup/BackupManagerService;->startConfirmationTimeout(ILcom/android/server/backup/BackupManagerService$FullParams;)V
- 
      const-string v3, "BackupManagerService"
  
      const-string v4, "Waiting for full backup completion..."
--- 10190,10195 ----
***************
*** 10391,10397 ****
  
      const-string v6, "fullrest"
  
!     invoke-virtual {p0, v5, v6}, Lcom/android/server/backup/BackupManagerService;->startConfirmationUi(ILjava/lang/String;)Z
  
      move-result v6
  
--- 10398,10408 ----
  
      const-string v6, "fullrest"
  
!     invoke-virtual {p1}, Landroid/os/ParcelFileDescriptor;->getFd()I
! 
!     move-result v7
! 
!     invoke-static {p0, v5, v6, v7}, Lcom/android/server/backup/BackupManagerServiceInjector;->startConfirmationUi(Lcom/android/server/backup/BackupManagerService;ILjava/lang/String;I)Z
  
      move-result v6
  
***************
*** 10504,10511 ****
  
      invoke-virtual {v6, v8, v9, v7, v10}, Landroid/os/PowerManager;->userActivity(JII)V
  
-     invoke-virtual {p0, v5, v4}, Lcom/android/server/backup/BackupManagerService;->startConfirmationTimeout(ILcom/android/server/backup/BackupManagerService$FullParams;)V
- 
      const-string v6, "BackupManagerService"
  
      const-string v7, "Waiting for full restore completion..."
--- 10515,10520 ----
