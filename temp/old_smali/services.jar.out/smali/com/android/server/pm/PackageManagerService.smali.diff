*** ./smali/com/android/server/pm/PackageManagerService.smali	2018-02-09 22:28:46.226115314 +0530
--- /root/prithvi/patchrom/device/temp/new_smali/services.jar.out/./smali/com/android/server/pm/PackageManagerService.smali	2018-02-09 22:18:23.188614833 +0530
***************
*** 46347,46352 ****
--- 46347,46361 ----
      check-cast v6, Landroid/content/pm/PackageParser$Activity;
  
      .local v6, "a":Landroid/content/pm/PackageParser$Activity;
+     invoke-static {}, Lmiui/securityspace/XSpaceUserHandle;->isXSpaceUserCalling()Z
+ 
+     move-result v0
+ 
+     if-eqz v0, :cond_miui_2
+ 
+     or-int/lit16 p2, p2, 0x2000
+ 
+     :cond_miui_2
      if-eqz v6, :cond_2
  
      iget-object v0, p0, Lcom/android/server/pm/PackageManagerService;->mSettings:Lcom/android/server/pm/Settings;
***************
*** 46896,46902 ****
  .end method
  
  .method public getApplicationInfo(Ljava/lang/String;II)Landroid/content/pm/ApplicationInfo;
!     .locals 9
      .param p1, "packageName"    # Ljava/lang/String;
      .param p2, "flags"    # I
      .param p3, "userId"    # I
--- 46905,46911 ----
  .end method
  
  .method public getApplicationInfo(Ljava/lang/String;II)Landroid/content/pm/ApplicationInfo;
!     .locals 10
      .param p1, "packageName"    # Ljava/lang/String;
      .param p2, "flags"    # I
      .param p3, "userId"    # I
***************
*** 46977,46983 ****
--- 46986,47007 ----
      invoke-static {v6, p2, v0, p3}, Landroid/content/pm/PackageParser;->generateApplicationInfo(Landroid/content/pm/PackageParser$Package;ILandroid/content/pm/PackageUserState;I)Landroid/content/pm/ApplicationInfo;
  
      move-result-object v0
+     
+     if-nez v0, :cond_miui_2
+     
+     invoke-static {}, Lmiui/securityspace/XSpaceUserHandle;->isXSpaceUserCalling()Z
+ 
+     move-result v9
+ 
+     if-eqz v9, :cond_miui_2
+ 
+     or-int/lit16 p2, p2, 0x2000
+ 
+     invoke-direct {p0, p1, p2, p3}, Lcom/android/server/pm/PackageManagerService;->generateApplicationInfoFromSettingsLPw(Ljava/lang/String;II)Landroid/content/pm/ApplicationInfo;
  
+     move-result-object v0
+     
+     :cond_miui_2
      monitor-exit v1
  
      goto :goto_0
***************
*** 48607,48613 ****
  .end method
  
  .method public getPackageInfo(Ljava/lang/String;II)Landroid/content/pm/PackageInfo;
!     .locals 8
      .param p1, "packageName"    # Ljava/lang/String;
      .param p2, "flags"    # I
      .param p3, "userId"    # I
--- 48631,48637 ----
  .end method
  
  .method public getPackageInfo(Ljava/lang/String;II)Landroid/content/pm/PackageInfo;
!     .locals 9
      .param p1, "packageName"    # Ljava/lang/String;
      .param p2, "flags"    # I
      .param p3, "userId"    # I
***************
*** 48665,48670 ****
--- 48689,48709 ----
  
      move-result-object v0
  
+     if-nez v7, :cond_miui_1
+ 
+     invoke-static {}, Lmiui/securityspace/XSpaceUserHandle;->isXSpaceUserCalling()Z
+ 
+     move-result v8
+ 
+     if-eqz v8, :cond_miui_1
+ 
+     or-int/lit16 p2, p2, 0x2000
+ 
+     invoke-direct {p0, p1, p2, p3}, Lcom/android/server/pm/PackageManagerService;->generatePackageInfoFromSettingsLPw(Ljava/lang/String;II)Landroid/content/pm/PackageInfo;
+ 
+     move-result-object v0
+ 
+     :cond_miui_1
      monitor-exit v1
  
      goto :goto_0
***************
*** 50448,50453 ****
--- 50487,50501 ----
      check-cast v7, Landroid/content/pm/PackageParser$Service;
  
      .local v7, "s":Landroid/content/pm/PackageParser$Service;
+     invoke-static {}, Lmiui/securityspace/XSpaceUserHandle;->isXSpaceUserCalling()Z
+ 
+     move-result v0
+ 
+     if-eqz v0, :cond_miui_1
+ 
+     or-int/lit16 p2, p2, 0x2000
+ 
+     :cond_miui_1
      if-eqz v7, :cond_2
  
      iget-object v0, p0, Lcom/android/server/pm/PackageManagerService;->mSettings:Lcom/android/server/pm/Settings;
***************
*** 52149,52154 ****
--- 52197,52208 ----
      .local v8, "state":Landroid/content/pm/PackageUserState;
      if-eqz v8, :cond_1
  
+     invoke-static {}, Lmiui/securityspace/XSpaceUserHandle;->isXSpaceUserCalling()Z
+     
+     move-result v3
+     
+     if-nez v3, :cond_1
+     
      invoke-static {v8}, Landroid/content/pm/PackageParser;->isAvailable(Landroid/content/pm/PackageUserState;)Z
  
      move-result v3
